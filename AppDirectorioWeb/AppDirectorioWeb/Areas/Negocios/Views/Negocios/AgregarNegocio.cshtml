@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@model Models.ViewModels.AddUpdBusinessViewModel;


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
<section class="bg-light py-5 height100vh">
    <div class="container">
        <nav class="bg-transparent breadcrumb breadcrumb-2 px-0 mb-5" aria-label="breadcrumb">
            <h2 class="font-weight-normal mb-4 mb-md-0">Agregar un negocio </h2>

            @*<ul class="list-unstyled d-flex p-0 m-0">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="dashboard-list-admin.html">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Submit Listings</li>
            </ul>*@
        </nav>
        <h6><span class="text-danger">Los campos con asterisco ( * ) en rojo son requeridos</span></h6>
        <form enctype="multipart/form-data" id="form_atencion" asp-controller="Negocios" asp-antiforgery="true" method="post">
            @if (!SignInManager.IsSignedIn(User))
            {


                <div class="card">
                    <div class="card-body px-6 pt-6 pb-1">

                        <div class="bg-light p-5 mb-8 rounded">
                            <h3 class="h4 font-weight-normal mb-4">Subscripción</h3>
                            <div class="row justify-content-between">
                                <div class="col-md-6">

                                    <div>
                                        <select id="cboPlanSus" class="form-control">
                                            <option value="1">Gratis</option>
                                            @*<option value="2">Profesional 44.99 USD/AÑO</option>*@

                                        </select>
                                        <input asp-for="User.IdPlan" id="inputPlanType" type="hidden" value="@ViewBag.IdPlan" />
                                        <input type="hidden" id="inputTypeUserMode" value="n" />
                                        <span asp-validation-for="User.IdPlan" class="text-danger"></span>
                                    </div>

                                </div>
                                <div class="col-md-5">
                                    <div class="d-flex ">
                                        <a class="btn btn-link pl-0" asp-area="Negocios" asp-controller="Negocios" asp-action="GetPlanScreen" target="_blank">Ver detalle de precios</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h3 class="h4 mb-4">Información  del propietario del negocio</h3>
                        <p class="mb-5">
                            <span class="text-danger">
                                <strong>
                                    Con esta información se le creará un usuario administrador para su negocio, el correo será el mismo que se usará como contacto principal para su negocio
                                </strong>
                            </span>
                        </p>
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <div class="row">


                            <div class="form-group col-md-6 mb-4">
                                @*<label for="inputAddress">Dirección Email*</label>
                                <input type="email" class="form-control" placeholder="Ej: peter@email.com" required>*@

                                <label asp-for="User.Email"></label>

                                <span class="text-danger">*</span>
                                <input asp-for="User.Email" class="form-control" />
                                <span asp-validation-for="User.Email" class="text-danger"></span>
                                @if (!string.IsNullOrEmpty(ViewBag.MessageUserExist))
                                {
                                    <span class="text-danger">@ViewBag.MessageUserExist</span>
                                }
                            </div>
                            <div class="form-group col-md-6 mb-4"></div>
                            <div class="form-group col-md-6 mb-4">
                                @*<label for="inputAddress">Dirección Email*</label>
                                <input type="email" class="form-control" placeholder="Ej: peter@email.com" required>*@

                                <label asp-for="User.FullName"></label>
                                <span class="text-danger">*</span>
                                <input asp-for="User.FullName" class="form-control" />
                                <span asp-validation-for="User.FullName" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-6 mb-4"></div>
                            <div class="form-group col-md-6 mb-4">
                                @*<label for="inputAddress">Dirección Email*</label>
                                <input type="email" class="form-control" placeholder="Ej: peter@email.com" required>*@

                                <label asp-for="User.Telefono"></label>

                                <span class="text-danger">*</span>
                                <input asp-for="User.Telefono" class="form-control" />
                                <span asp-validation-for="User.Telefono" class="text-danger"></span>
                            </div>


                            <div class="form-group col-md-6 mb-4"></div>
                            <div class="form-group col-md-4 mb-4">
                                @*<label for="inputPassword">Contraseña*</label>
                                <input type="password" class="form-control" placeholder="Al menos 6 caracteres" required>*@

                                <label asp-for="User.Password"></label>
                                <span class="text-danger">*</span>
                                <input asp-for="User.Password" class="form-control" />
                                <span asp-validation-for="User.Password" class="text-danger"></span>
                                <span class="text-info">*Tu contraseña debe contener al menos un carácter no alfanumérico.(Como *) y una mayúscula, minímo 8 dígitos de longitud</span>
                                @if (!string.IsNullOrEmpty(ViewBag.errorPass))
                                {
                                    <span class="text-danger">@ViewBag.errorPass</span>
                                }
                            </div>

                            <div class="form-group col-md-4 mb-4">
                                @*<label for="inputPassword">Contraseña*</label>
                                <input type="password" class="form-control" placeholder="Al menos 6 caracteres" required>*@

                                <label asp-for="User.ConfirmPassword"></label>
                                <span class="text-danger">*</span>
                                <input asp-for="User.ConfirmPassword" class="form-control" />
                                <span asp-validation-for="User.ConfirmPassword" class="text-danger"></span>
                            </div>
                            <div class="form-group col-md-4 mb-4">


                            </div>
                            <div class="form-group col-md-6 mb-4">
                                <div class="checkbox">
                                    <label>
                                        <input id="chkTerm" type="checkbox">
                                        Estoy de acuerdo con los <a target="_blank" asp-area="Home" asp-controller="Home" asp-action="GetTermsAndConditions">Terminos y Condiciones de uso</a>.
                                    </label>
                                </div>
                            </div>


                        </div>
                    </div>

                </div>
            }
            else
            {

                <input type="hidden" asp-for="User.Email" value="example@email.com" class="form-control" />
                <input type="hidden" asp-for="User.Password" value="Example1234*" class="form-control" />
                <input type="hidden" asp-for="User.ConfirmPassword" value="Example1234*" class="form-control" />

                <input type="hidden" asp-for="User.FullName" value="example user" class="form-control" />
                <input type="hidden" asp-for="User.Telefono" value="88888888" class="form-control" />
            }

            <input type="hidden" id="inputTypeUserMode" value="e" />
            <input asp-for="User.IdPlan" id="inputPlanType" type="hidden" value="@ViewBag.IdPlan" />
            <div class="card  p-5 mb-8 rounded">
                <h3 class="h4 font-weight-normal mb-4">  <span class="text-danger">*</span>Url personalizada para tu negocio (Comparte este link con tus clientes o redes sociales)</h3>

                <div class="row ">
                    <div class="col-md-2">
                        <div class="d-flex ">
                            <a class="btn btn-link pl-0" href="#">www.brujulapyme.com/</a>
                        </div>
                    </div>
                    <div class="col-md-2">

                        <div>
                            <input asp-for="Business.PersonalUrl" class="form-control" />

                            <span id="PersonalUrlMessageError" asp-validation-for="Business.PersonalUrl" class="text-danger"></span>
                        </div>


                    </div>
                    <div class="col-md-2"><button type="button" id="btnCopiarLink" class="btn btn-primary">Copiar link</button></div>
                </div>
            </div>
            <div class="card">
                <div class="card-body px-6 pt-6 pb-1">
                    <h3 class="h4 mb-4">Información del negocio</h3>
                    <p class="mb-5"><strong>No somos responsables de ningún daño causado por el uso de este sitio web o por publicar listados de negocios aquí. Utilice nuestro sitio a su propia discreción y ejerza el buen juicio, así como el sentido común al anunciar negocios aquí.</strong></p>
                    <input asp-for="Business.Id" type="hidden" />
                    <input asp-for="Business.IdUserOwner" type="hidden" />
                    <div class="row">
                        <div class="form-group col-md-6 mb-6">
                            <label for="listingTitle">Nombre del negocio</label>
                            <span class="text-danger">*</span>
                            <input asp-for="Business.NombreNegocio" class="form-control" />
                            <span asp-validation-for="Business.NombreNegocio" class="text-danger"></span>
                        </div>


                        <div class="form-group col-md-6 mb-6">
                            <label for="exampleFormControlSelect1">Categoria</label>
                            <span class="text-danger">*</span>
                            <div class="select-default bg-white">
                                @Html.DropDownListFor(m => m.Business.IdCategoria, Model.Business.Categories, "- SELECCIONA UNA CATEGORÍA -", new { @class = "form-control" })
                                <span asp-validation-for="Business.IdCategoria" class="text-danger"></span>
                                <span class="text-danger">Si no existe la categoría que busca, contactenos para agregarla.</span>
                            </div>
                        </div>

                        <div class="form-group col-md-12 mb-6">
                            <label for="discribeTheListing">Descripción del negocio</label>
                            <span class="text-danger">*</span>
                            <textarea asp-for="Business.DescripcionNegocio" class="form-control" rows="6" required></textarea>
                            <span asp-validation-for="Business.DescripcionNegocio" class="text-danger"></span>
                        </div>

                        @*<div class="form-group col-md-12 mb-6">
                            <label for="addTags">Tags (Los tags son como palabras claves con las cuales el usuario te puede buscar)</label>
                            <input asp-for="Business.Tags" class="form-control" />
                            <span asp-validation-for="Business.Tags" class="text-danger"></span>
                        </div>*@
                    </div>


                </div>
            </div>

            @*Contact*@
            <div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Contacto</h3>


                    <div class="row">
                        <div class="col-md-6">

                            @*<div class="form-group mb-6">
                                <label for="exampleFormControlSelect1">Pais</label>
                                <div class="select-default bg-white">
                                    <select class="form-control" id="IdPais" required>
                                        <option value="">Eliga una opción</option>
                                    </select>
                                </div>
                            </div>*@

                            <div class="form-group mb-6">
                                <label for="exampleFormControlSelect1">Departamento</label>
                                <span class="text-danger">*</span>
                                <div class="select-default bg-white">
                                    @Html.DropDownListFor(m => m.Business.IdDepartamento, Model.Business.Departamentos, "- SELECCIONA UN DEPARTAMENTO -", new { @class = "form-control " })
                                    <span asp-validation-for="Business.IdDepartamento" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group mb-6">
                                <label for="discribeTheListing">Dirección del negocio</label>
                                <span class="text-danger">*</span>
                                <textarea asp-for="Business.DireccionNegocio" class="form-control" rows="3" required></textarea>
                                <span asp-validation-for="Business.DireccionNegocio" class="text-danger"></span>
                            </div>

                            <div class="form-group mb-6">
                                <label for="listingPhone">Telefono</label>
                                <span class="text-danger">*</span>
                                <input asp-for="Business.TelefonoNegocio1" placeholder="88888888" class="form-control" />
                                <span asp-validation-for="Business.TelefonoNegocio1" class="text-danger"></span>
                            </div>


                            @*<div class="form-group mb-6">
                                <label for="listingPhone">Correo electronico</label>
                                <input asp-for="Business.EmailNegocio" class="form-control" />
                                <span asp-validation-for="Business.EmailNegocio" class="text-danger"></span>
                            </div>*@



                        </div>


                        @*<div class="col-md-6 map-place-search-wrapper">
                            <div class="form-group mb-0 ">
                                <label for="listingAddress">Selecciona la ubicación de tu negocio, este paso es muy importante</label>

                            </div>
                            <div style=" height: 90%; " class="map-container" id="mapholder"></div>
                            <div>

                                <div class="form-group col-md-6">

                                    <input id="inputlat" style="visibility:hidden;" type="text" class="form-control" />

                                </div>
                                <div class="form-group col-md-6">

                                    <input id="inputlon" style="visibility:hidden;" type="text" class="form-control" />

                                </div>

                            </div>

                        </div>*@

                    </div>
                </div>
            </div>

            @*Social*@
            <div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Redes Sociales</h3>


                    <div class="row">
                        <div class="form-group col-md-6 mb-6">
                            <label for="youtubeUrl">WhatsApp</label>
                            <span class="text-danger">*</span>
                            <input asp-for="Business.TelefonoWhatsApp" class="form-control" />
                            <span asp-validation-for="Business.TelefonoWhatsApp" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-12 mb-12">
                            <label for="youtubeUrl">Pagina web</label>
                            <input asp-for="Business.SitioWebNegocio" class="form-control" />
                            <span asp-validation-for="Business.SitioWebNegocio" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-6 mb-6">
                            <label for="linkedUrl">Facebook</label>
                            <input asp-for="Business.FacebookUrl" class="form-control" />
                            <span asp-validation-for="Business.FacebookUrl" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-6 mb-6">
                            <label for="facebookUrl">Instagram</label>
                            <input asp-for="Business.InstagramUrl" class="form-control" />
                            <span asp-validation-for="Business.InstagramUrl" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-6 mb-6">
                            <label for="twitterUrl">Twitter</label>
                            <input asp-for="Business.TwitterUrl" class="form-control" />
                            <span asp-validation-for="Business.TwitterUrl" class="text-danger"></span>
                        </div>


                        <div class="form-group col-md-6 mb-6">
                            <label for="youtubeUrl">Linkedin</label>
                            <input asp-for="Business.LinkedInUrl" class="form-control" />
                            <span asp-validation-for="Business.LinkedInUrl" class="text-danger"></span>
                        </div>

                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Servicio a domicilio</h3>


                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-check mb-6 ">
                                <div class="row align-items-center form-check-readonly">
                                    <div class="col-5">
                                        <input asp-for="Business.HasDelivery" class="form-check-input" type="checkbox">
                                        <label class="form-check-label" for="monday">Servicio a domicilio</label>
                                    </div>
                                    @*<div class="col-3">
                                        <input asp-for="Business.Hugo" class="form-check-input" type="checkbox">
                                        <label class="form-check-label" for="monday">Hugo</label>
                                    </div>
                                    <div class="col-3">
                                        <input asp-for="Business.PedidosYa" class="form-check-input" type="checkbox">
                                        <label class="form-check-label" for="monday">Pedidos Ya</label>
                                    </div>
                                    <div class="col-3">
                                        <input asp-for="Business.Piki" class="form-check-input" type="checkbox">
                                        <label class="form-check-label" for="monday">Piki</label>
                                    </div>*@
                                </div>
                            </div>
                        </div>



                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Características</h3>


                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group form-check mb-6 ">
                                <div class="row align-items-center form-check-readonly">
                                    @for (int i = 0; i < Model.FeatureNegocios.Count; i++)
                                    {
                                        <div class="col-6">
                                            <input type="hidden" asp-for="@Model.FeatureNegocios[i].Id" />
                                            <input type="hidden" asp-for="@Model.FeatureNegocios[i].IdFeature" />
                                            <input asp-for="@Model.FeatureNegocios[i].Activo" type="checkbox" class="form-check-input">
                                            <label class="form-check-label">@Model.FeatureNegocios[i].Feature</label>
                                        </div>
                                    }


                                </div>
                            </div>
                        </div>



                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Horario de atención</h3>
                    <p class="mb-5">
                        <span class="text-danger">
                            <strong>
                                Los días que no tengan el check (✓) saldrán como cerrados, puede editar los horarios sugeridos y cambiarlos.
                            </strong>
                        </span>
                    </p>

                    @if (Model.Business.Id == null || Model.Business.Id == 0)
                    {
                        <div class="row">
                            @for (int i = 0; i < Model.HorarioNegocios.Count; i++)
                            {
                                <div class="col-md-6">
                                    <div class="form-group form-check mb-6 ">
                                        <div class="row align-items-center form-check-readonly">
                                            <div class="col-3">
                                                <input asp-for="@Model.HorarioNegocios[i].Id" type="hidden">
                                                @if (Model.HorarioNegocios[i].Day == "Domingo" || Model.HorarioNegocios[i].Day == "Sábado")
                                                {
                                                    <input asp-for="@Model.HorarioNegocios[i].Active" type="checkbox" class="form-check-input">
                                                }
                                                else
                                                {
                                                    <input asp-for="@Model.HorarioNegocios[i].Active" type="checkbox" class="form-check-input" checked>
                                                }

                                                <label class="form-check-label">@Model.HorarioNegocios[i].Day</label>
                                                <input type="hidden" asp-for="@Model.HorarioNegocios[i].IdDia" />
                                            </div>
                                            <div class="col-3 pr-0">
                                                <input value="08:00 AM" asp-for="@Model.HorarioNegocios[i].HoraDesde" class="form-control form-control-sm timepicker">
                                            </div>
                                            <div class="col-1 text-center px-0">-</div>
                                            <div class="col-3 pl-0">
                                                <input value="05:00 PM" asp-for="@Model.HorarioNegocios[i].HoraHasta" class="form-control form-control-sm timepicker">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }


                        </div>
                    }
                    else
                    {
                        <div class="row">
                            @for (int i = 0; i < Model.HorarioNegocios.Count; i++)
                            {
                                <div class="col-md-6">
                                    <div class="form-group form-check mb-6 ">
                                        <div class="row align-items-center form-check-readonly">
                                            <div class="col-3">
                                                <input asp-for="@Model.HorarioNegocios[i].Id" type="hidden">
                                                <input asp-for="@Model.HorarioNegocios[i].Active" type="checkbox" class="form-check-input">
                                                <label class="form-check-label">@Model.HorarioNegocios[i].Day</label>
                                                <input type="hidden" asp-for="@Model.HorarioNegocios[i].IdDia" />
                                            </div>
                                            <div class="col-3 pr-0">
                                                <input asp-for="@Model.HorarioNegocios[i].HoraDesde" class="form-control form-control-sm timepicker">
                                            </div>
                                            <div class="col-1 text-center px-0">-</div>
                                            <div class="col-3 pl-0">
                                                <input asp-for="@Model.HorarioNegocios[i].HoraHasta" class="form-control form-control-sm timepicker">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }


                        </div>
                    }

                </div>
            </div>



            @*Gallery*@
            @*<div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Galeria de fotos Productos/Servicios</h3>
                    <input asp-for="@Model.Business.LogoNegocio" type="hidden" />


                    @if ((Model.Business.Id != 0 || Model.Business.Id != null) && (Model.ImagenesNegocios != null && Model.ImagenesNegocios.Count > 0))
                    {
                        <a id="adelpictures" onclick="DeletePictures(@Model.Business.Id)" class="text-danger">@Model.ImagenesNegocios.Count Imagen(es) cargadas...     Eliminar <span class="fa fa-close"></span></a>

                        <div class="form-group col-md-5">

                            <input accept="image/*" class="form-control custom-file-input cfis cfisinvisible" asp-for="PicturesBusiness" multiple />
                            <label class="custom-file-label cfls">Selecciona fotos de tus productos/servicios...</label>
                            <span class="text-danger field-validation-error"><span id="galVal" class=""></span></span>
                        </div>

                    }
                    else
                    {
                        <div class="form-group col-md-5">

                            <input accept="image/*" class="form-control custom-file-input cfis" asp-for="PicturesBusiness" multiple />
                            <label class="custom-file-label cfls">Selecciona fotos de tus productos/servicios...</label>
                            <span class="text-danger field-validation-error"><span id="galVal" class=""></span></span>
                        </div>
                    }


                </div>
            </div>*@

            <div class="card">
                <div class="card-body p-6">
                    <h3 class="h4 mb-4">Logo de negocio</h3>
                    @if ((Model.Business.Id != 0 || Model.Business.Id != null) && !string.IsNullOrEmpty(Model.Business.LogoNegocio))
                    {
                        <a id="adellogo" onclick="DeleteLogo(@Model.Business.Id)" class="text-danger">@Model.Business.LogoNegocio     Eliminar <span class="fa fa-close"></span></a>

                        <div class="form-group col-md-5">
                            <input accept="image/*" asp-for="Logo" class="form-control custom-file-input cfi cfiinvisible">
                            <label class="custom-file-label cfl ">Selecciona el logo de tu negocio...</label>
                            <span class="text-danger field-validation-error"><span id="logoVal" class=""></span></span>
                        </div>

                    }
                    else
                    {
                        <div class="form-group col-md-5">
                            <input accept="image/*" asp-for="Logo" class="form-control custom-file-input cfi">
                            <label class="custom-file-label cfl">Selecciona el logo de tu negocio...</label>
                            <span class="text-danger field-validation-error"><span id="logoVal" class=""></span></span>
                        </div>
                    }




                </div>
            </div>



            <div class="row justify-content-center">
                <div class="col-md-7 col-lg-6 col-xl-5">
                    <div class="mb-6">
                        @if (Model.Business.Id == 0 || Model.Business.Id == null)
                        {
                            <button formaction="AgregarNegocio" id="btnCrearCuenta" type="submit" class="btn btn-lg btn-primary btn-block">Crear Negocio</button>
                        }
                        else
                        {
                            <button formaction="AgregarNegocio" id="btnUpdateNegocio" type="submit" class="btn btn-lg btn-primary btn-block">Actualizar Negocio</button>
                        }

                    </div>
                </div>
            </div>

        </form>

    </div>
</section>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/Handlers/AddNewBusinessHandler.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
}